<% include ../common/header.ejs %>
<style type="text/css">
    .ant-form-item-label{
        text-align: right;
        vertical-align: middle;
        padding: 7px 0;
        display: inline-block;
    }
    .ant-col-10 {
        display: block;
        width: 100px;
    }
    .ant-col-14 {
        display: block;
        width: 150px;
    }
</style>
<div class="content" ng-app="myApp" ng-controller="appCtrl">
    <div class="sidle-left">
        <% include ../common/menu.ejs %>
    </div>
    <div class="sidle-right">
        <div class="title">
            <h4>消息日志</h4>
        </div>
        <div class="ant-search-input-wrapper" style="width: 200px;margin-bottom: 10px;">
            <span class="ant-input-group ant-search-input">
                <span class="ant-input-wrapper">
                    <input type="text" placeholder="模板编号或名称" value="" class="ant-input"
                           ng-model="keyword">
                </span>
                <div class="ant-input-group-wrap">
                    <button type="button" ng-click="keywordSearch()" class="ant-btn ant-btn-icon-only ant-search-btn"><i
                                class="anticon anticon-search"></i></button>
                </div>
            </span>
        </div>
        <form class="ant-form ant-form-horizontal ant-advanced-search-form">
            <div class="ant-row" style="margin-left: -8px; margin-right: -8px;">
                <div class="ant-col-sm-8" style="padding-left: 8px; padding-right: 8px;">
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">较长搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-calendar-picker"><span><input
                                                readonly="" value="" placeholder="请选择日期"
                                                class="ant-calendar-range-picker ant-input"><span
                                                class="ant-calendar-picker-icon"></span></span></span></div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ant-col-sm-8" style="padding-left: 8px; padding-right: 8px;">
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">较长搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-calendar-picker"><span><input
                                                readonly="" value="" placeholder="请选择日期"
                                                class="ant-calendar-range-picker ant-input"><span
                                                class="ant-calendar-picker-icon"></span></span></span></div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ant-col-sm-8" style="padding-left: 8px; padding-right: 8px;">
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">较长搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-calendar-picker"><span><input
                                                readonly="" value="" placeholder="请选择日期"
                                                class="ant-calendar-range-picker ant-input"><span
                                                class="ant-calendar-picker-icon"></span></span></span></div>
                        </div>
                    </div>
                    <div class="ant-row ant-form-item">
                        <div class="ant-col-10 ant-form-item-label"><label class="">搜索名称</label></div>
                        <div class="ant-col-14">
                            <div class="ant-form-item-control "><span class="ant-input-wrapper"><input type="text"
                                                                                                       placeholder="请输入搜索名称"
                                                                                                       class="ant-input"
                                                                                                       value=""></span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="ant-row">
                <div class="ant-col-12 ant-col-offset-12" style="text-align: right;">
                    <button type="submit" class="ant-btn ant-btn-primary"><span>搜 索</span></button>
                    <button type="button" class="ant-btn"><span>清除条件</span></button>
                </div>
            </div>
        </form>

        <div class="ant-table ant-table-large ant-table-scroll-position-left">
            <div class="ant-table-content">
                <div class="ant-table-body">
                    <table class="">
                        <thead class="ant-table-thead">
                        <tr>
                            <th class=""><span>appkey</span></th>
                            <th class=""><span>发送时间</span></th>
                            <th class=""><span>类型</span></th>
                            <th class=""><span>消息来源</span></th>
                            <th class=""><span>发送到</span></th>
                            <th class=""><span>内容</span></th>
                            <th class=""><span>状态</span></th>
                            <th class=""><span>描述</span></th>
                        </tr>
                        </thead>
                        <tbody class="ant-table-tbody">
                        <tr class="ant-table-row  ant-table-row-level-0" ng-repeat="item in table">
                            <td class="">
                                <!--<span class="ant-table-row-indent indent-level-0" style="padding-left: 0px;"></span>-->
                                <!--<a href="#">{{item.fd_shopexid}}</a>-->
                                {{item.c_temp_no}}
                            </td>
                            <td class="">
                                <span style="white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    display: block;
    max-width: 200px;">{{item.c_temp_content}}</span>
                            </td>
                            <td class="">
                                {{item.c_temp_status}}
                            </td>
                            <td class="">{{item.c_temp_create_time | date: 'yyyy-MM-dd HH:mm:ss'}}</td>
                            <td class="">{{item.c_temp_desc}}</td>
                            <td class="">
                                <span>
                                    <a ng-href="/template/edit/{{item.c_temp_no}}">编辑</a>
                                    <span class="ant-divider"></span>
                                    <a href="#" title="同步到短信服务器">同步</a>
                                    <!--<a href="#" class="ant-dropdown-link">更多-->
                                        <!--<i class="anticon anticon-down"></i>-->
                                    <!--</a>-->
                                </span>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <ul class="ant-pagination ant-table-pagination" unselectable="unselectable">
                <li style="display: inline-block;
                    float: left;
                    position: relative;
                    right: 10px;
                    top: 4px;">
                    <a>
                        <span>共{{param.count}}条</span>
                    </a>
                </li>
                <li title="上一页"
                    class="ant-pagination-prev"
                    ng-click="prev()"
                    ng-class="{1:'ant-pagination-disabled'}[param.pagenum]"><a></a></li>
                <li title="{{pag.key}}"
                    class="ant-pagination-item"
                    ng-class="{true:'ant-pagination-item-active'}[pag.active]"
                    ng-click="showpage()"
                    ng-repeat="pag in pagination"><a>{{pag.key}}</a></li>
                <li title="下一页"
                    class="ant-pagination-next"
                    ng-click="next()"
                    ng-class="{true:'ant-pagination-disabled'}[param.pagenum == param.pages]"
                        ><a></a></li>
            </ul>
        </div>
        <!--<div id="clickme" ng-click="submit()" class="btn btn-success">clickme</div>-->
    </div>
</div>
<% include ../common/footer.ejs %>

<script type="text/javascript">
    angular.module('myApp', ['angular-loading-bar'])
            .config(['$httpProvider', 'cfpLoadingBarProvider', function ($httpProvider, cfpLoadingBarProvider) {
                cfpLoadingBarProvider.includeSpinner = true;
                //cfpLoadingBarProvider.parentSelector = '#loading-bar-container';
                cfpLoadingBarProvider.latencyThreshold = 5;
                //cfpLoadingBarProvider.spinnerTemplate = '<div><span class="fa fa-spinner" style="color: #fff">Custom Loading Message...</div>';
            }])
            .run(function (cfpLoadingBar) {
                cfpLoadingBar.start();
                cfpLoadingBar.complete();

            })
            .controller('appCtrl', ['$scope', '$http', 'cfpLoadingBar', function ($scope, $http, cfpLoadingBar) {
                $scope.table = [];
                $scope.keyword = ''; //默认账号名
                $scope.filtes = {
                    utype1: false,
                    utype2: false
                }
                //查询参数
                $scope.param = {
                    pagenum: 1,    //页码
                    pagesize: 10,        //页大小
                    count: 0,
                    pages: 0,
                    searchParams: {
                        filters: [],
                        logic: 'OR'
                    }
                }

                //查询所有用户
                $scope.getAppApplyList = function (index) {
                    $scope.param.pagenum = index || $scope.param.pagenum;
                    $scope.param.searchParams = {
                        filters: [],
                        logic: 'OR'
                    }
                    if ($scope.keyword != '') {
                        var array = [];
                        array.push(
                                {
                                    filed: 'c_content', operator: 'like', value: $scope.keyword
                                });
                        $scope.param.searchParams['filters'] = array;
                    }
                    var fd_date_filter = {
                        filters: [],
                        logic: 'AND'
                    };
                    fd_date_filter.filters.push({filed: 'c_create_time', operator: 'gte', value: 1});
                    fd_date_filter.filters.push({filed: 'c_create_time', operator: 'lt', value: 2});

                    if (fd_date_filter.filters.length > 0) {
                        $scope.param.searchParams['filters'].push(fd_date_filter);
                    }

                    $http.post('/getLog', $scope.param).success(function (result) {
                        if (result.status == '0000') {
                            $scope.table = result.data.datasouce;
                            $scope.param.pagenum = result.data.pagenum;
                            $scope.param.pages = result.data.pages;
                            $scope.param.pagesize = result.data.pagesize;
                            $scope.param['count'] = result.data.count;

                            $scope.pagination = [];
                            for (var i = 1; i <= $scope.param.pages; i++) {
                                $scope.pagination.push({
                                    key: i,
                                    active: i == $scope.param.pagenum ? true : false
                                })
                            }
                        }
                    });
                }

                $scope.getAppApplyList();

                $scope.keywordSearch = function () {
                    $scope.getAppApplyList(1);
                }

                $scope.showpage = function () {
                    $scope.param.pagenum = this.pag.key;    //页码
                    $scope.getAppApplyList();
                }

                $scope.prev = function () {
                    if ($scope.param.pagenum > 1) {
                        $scope.param.pagenum--;
                        $scope.getAppApplyList();
                    }
                }

                $scope.next = function () {
                    if ($scope.param.pagenum < $scope.param.pages) {
                        $scope.param.pagenum++;
                        $scope.getAppApplyList();
                    }
                }

            }])
</script>