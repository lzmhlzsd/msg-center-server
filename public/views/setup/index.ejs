<% include ../common/header.ejs %>

<div class="content" ng-app="myApp" ng-controller="appCtrl">
    <div class="sidle-left">
        <% include ../common/menu.ejs %>
    </div>
    <div class="sidle-right">
        <div class="title">
            <h4>设置中心</h4>
        </div>
        <a class="btn btn-ant" style="display: inline-block;margin-bottom: 10px;" ng-click="save()">保存</a>
        <br>

        <div class="card-inline">
            <div class="ant-card ant-card-bordered" style="width: 100%;">
                <div class="ant-card-head">
                    <h3 class="ant-card-head-title">邮件设置</h3>
                </div>
                <div class="ant-card-body">
                    <form class="ant-form-horizontal">
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">host</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <select class="ant-input ant-input-lg" ng-model="params.host">
                                        <option value="smtp.163.com">smtp.163.com</option>
                                        <option value="smtp.qq.com">smtp.qq.com</option>
                                        <option value="smtp.sina.com">smtp.sina.com</option>
                                        <option value="smtp.126.com">smtp.126.com</option>
                                    </select>
                                </span>
                                </div>
                            </div>
                        </div>
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">端口</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="warning" class="ant-input ant-input-lg"
                                           ng-model="params.port">
                                </span>
                                </div>
                            </div>
                        </div>
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">用户名</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="validating"
                                           class="ant-input ant-input-lg"
                                           autocomplete="off" ng-model="params.username">
                                </span>
                                </div>
                            </div>
                        </div>
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">密码</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="success" class="ant-input ant-input-lg" autocomplete="off"
                                           ng-model="params.password">
                                </span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
            <br>

            <div class="ant-card ant-card-bordered" style="width: 100%;">
                <div class="ant-card-head">
                    <h3 class="ant-card-head-title">短信设置</h3>
                </div>
                <div class="ant-card-body">
                    <form class="ant-form-horizontal">
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">APIKEY</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="warning" class="ant-input ant-input-lg"
                                           ng-model="params.apikey">
                                </span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="card-inline">
            <div class="ant-card ant-card-bordered" style="width: 100%;">
                <div class="ant-card-head">
                    <h3 class="ant-card-head-title">微信设置</h3>
                </div>
                <div class="ant-card-body">
                    <form class="ant-form-horizontal">
                        <!--<div class="ant-row ant-form-item">-->
                            <!--<div class="ant-col-5 ant-form-item-label">-->
                                <!--<label class="">微信</label>-->
                            <!--</div>-->
                            <!--<div class="ant-col-12">-->
                                <!--<div class="ant-form-item-control">-->
                                <!--<span class="ant-input-wrapper">-->
                                    <!--<select class="ant-input ant-input-lg" ng-model="params.host">-->
                                        <!--<option value="qyh">企业号</option>-->
                                        <!--<option value="fwh">服务号</option>-->
                                        <!--<option value="dyh">订阅号</option>-->
                                    <!--</select>-->
                                <!--</span>-->
                                <!--</div>-->
                            <!--</div>-->
                        <!--</div>-->
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">CorpID</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="warning" class="ant-input ant-input-lg"
                                           ng-model="params.wxqy_corpid">
                                </span>
                                </div>
                            </div>
                        </div>
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">Secret</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="warning" class="ant-input ant-input-lg"
                                           ng-model="params.wxqy_secret">
                                </span>
                                </div>
                            </div>
                        </div>
                        <div class="ant-row ant-form-item">
                            <div class="ant-col-5 ant-form-item-label">
                                <label class="">应用ID</label>
                            </div>
                            <div class="ant-col-12">
                                <div class="ant-form-item-control">
                                <span class="ant-input-wrapper">
                                    <input type="text" id="warning" class="ant-input ant-input-lg"
                                           ng-model="params.c_weixin_qyh_agentid">
                                </span>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>


    </div>
</div>
<% include ../common/footer.ejs %>

<script type="text/javascript">
    angular.module('myApp', ['angular-loading-bar'])
            .config(['$httpProvider', 'cfpLoadingBarProvider', function ($httpProvider, cfpLoadingBarProvider) {
                cfpLoadingBarProvider.includeSpinner = true;
                cfpLoadingBarProvider.latencyThreshold = 5;
            }])
            .run(function (cfpLoadingBar) {
                cfpLoadingBar.start();
                cfpLoadingBar.complete();

            })
            .controller('appCtrl', ['$scope', '$http', 'cfpLoadingBar', function ($scope, $http, cfpLoadingBar) {

                $scope.params = {
                    host: 'smtp.qq.com',
                    port: 465,
                    username: '',
                    password: '',
                    apikey: '',
                    wxqy_corpid: '',
                    wxqy_secret: ''
                }

                $http.get('/getConfig')
                        .success(function (result) {
                            if (result.status == '0000') {
                                if (result.data.length > 0) {
                                    $scope.params = {
                                        host: result.data[0].c_email_host,
                                        port: result.data[0].c_email_port == '' ? 465 : result.data[0].c_email_port,
                                        username: result.data[0].c_email_username,
                                        password: result.data[0].c_email_password,
                                        apikey: result.data[0].c_msg_apikey,
                                        wxqy_corpid: result.data[0].c_weixin_qyh_cropid,
                                        wxqy_secret: result.data[0].c_weixin_qyh_screct,
                                        c_weixin_qyh_agentid: result.data[0].c_weixin_qyh_agentid
                                    }
                                }
                            }
                            else {
                                BootstrapDialog.show({
                                    title: '提示',
                                    message: '<i class="icon-model anticon anticon-cross-circle"></i>' +
                                    '<span class="ant-confirm-title">' + result.message + '</span>',
                                    type: BootstrapDialog.TYPE_DEFAULT,
                                    onshow: function (dialogRef) {
                                        setTimeout(function () {
                                            dialogRef.close();
                                        }, 2000);
                                    }
                                });
                            }
                        })

                $scope.save = function () {
                    $http.post('/saveConfig', $scope.params)
                            .success(function (result) {
                                if (result.status == '0000') {
                                    UI.success(result.message);
                                }
                                else {
                                    BootstrapDialog.show({
                                        title: '提示',
                                        message: '<i class="icon-model anticon anticon-cross-circle"></i>' +
                                        '<span class="ant-confirm-title">' + result.message + '</span>',
                                        type: BootstrapDialog.TYPE_DEFAULT,
                                        onshow: function (dialogRef) {
                                            setTimeout(function () {
                                                dialogRef.close();
                                            }, 2000);
                                        }
                                    });
                                }
                            })
                }

            }])
</script>